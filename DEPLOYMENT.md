# Data Pipeline Admin - Deployment Guide

## ğŸš€ Deployment Options

### 1. GitHub Pages Deployment

The admin interface is configured to deploy automatically to GitHub Pages at:
**https://model.earth/data-pipeline/admin**

#### Setup Steps:

1. **Push to GitHub**:
   ```bash
   git add .
   git commit -m "Add admin interface for GitHub Pages deployment"
   git push origin main
   ```

2. **Enable GitHub Pages**:
   - Go to your repository settings
   - Navigate to "Pages" section
   - Select "GitHub Actions" as the source
   - The workflow will automatically deploy on push to `main`

3. **Access**: Once deployed, visit:
   ```
   https://model.earth/data-pipeline/admin/
   ```

#### Files for GitHub Pages:
- `.github/workflows/deploy.yml` - Automatic deployment workflow
- `admin/next.config.js` - Configured with basePath for GitHub Pages
- `admin/out/` - Static build output (generated by `npm run build`)

---

### 2. Local HTTP Server (localhost:8887)

The admin interface is now available at:
**http://localhost:8887/data-pipeline/admin/**

#### Setup Complete:
âœ… Built files deployed to `data-pipeline/admin/` folder  
âœ… Configured for `/data-pipeline/admin` path  
âœ… Static files ready for your HTTP server  
âœ… Main data-pipeline/index.html restored

#### Files Deployed:
- `admin/index.html` - Main admin interface
- `admin/_next/` - Next.js assets and JavaScript  
- `admin/404.html` - Error page
- `index.html` - Main data-pipeline page (restored)

#### Test Access:
```bash
# If your HTTP server is running on port 8887
curl http://localhost:8887/data-pipeline/admin/
```

---

## ğŸ”§ Development Workflow

### Local Development:
```bash
cd admin
npm run dev
# Access at http://localhost:3000
```

### Build for Production:
```bash
cd admin
npm run build
# Static files generated and deployed automatically
# Old unused files are purged by default
```

### Build Without Purging Old Files:
```bash
cd admin
npm run build:no-purge
# Keeps all previous build files (useful for debugging)
```

### Remove-Unused Command:
Control whether old build files are automatically cleaned:

```bash
# Turn OFF automatic cleanup (keeps old files)
export PURGE_OLD_FILES=false

# Turn ON automatic cleanup (default, removes old files)  
export PURGE_OLD_FILES=true

# Check current setting
echo $PURGE_OLD_FILES
```

**ğŸ’¡ Terminal Startup Tip**: Add this to your shell profile (`~/.bashrc`, `~/.zshrc`) to persist the setting:
```bash
# Set to false to keep old build files for debugging
export PURGE_OLD_FILES=true  # Default: clean old files on each build
```

### Update Deployment:
```bash
# After making changes, rebuild and deploy:
cd admin
npm run build
git add . && git commit -m "Update admin interface" && git push
```

---

## ğŸ“ File Structure

```
data-pipeline/
â”œâ”€â”€ admin/                    # Next.js source + deployed files
â”‚   â”œâ”€â”€ components/          # React components (source)
â”‚   â”œâ”€â”€ pages/              # Next.js pages (source)
â”‚   â”œâ”€â”€ styles/             # Tailwind CSS (source)
â”‚   â”œâ”€â”€ out/                # Built static files
â”‚   â”œâ”€â”€ index.html          # Deployed admin interface
â”‚   â””â”€â”€ _next/              # Next.js assets
â”œâ”€â”€ index.html              # Main data-pipeline page
â”œâ”€â”€ nodes.csv               # Pipeline data source
â”œâ”€â”€ nodes.json              # Flow chart data
â””â”€â”€ .github/workflows/      # GitHub Actions deployment
```

---

## ğŸŒ URLs Summary

| Environment | URL | Status |
|-------------|-----|--------|
| **Development** | http://localhost:3000 | âœ… Ready |
| **Local HTTP Server** | http://localhost:8887/data-pipeline/admin | âœ… Ready |
| **GitHub Pages** | https://model.earth/data-pipeline/admin | ğŸ”„ Deploy to activate |

---

## ğŸ¨ Features Active

- **Dark Mode**: Space-flight inspired interface
- **Responsive Layout**: Column/Full Width/Floating modes  
- **Pipeline Management**: Node controls and monitoring
- **Flow Visualization**: Real-time diagram from nodes.json
- **Team Collaboration**: TODO management system
- **Python Execution**: Run pipeline processes (development only)

---

## ğŸ”§ Troubleshooting

### GitHub Pages Issues:
- Ensure repository has Pages enabled
- Check Actions tab for deployment status
- Verify `main` branch has latest changes

### Local Server Issues:
- Confirm HTTP server is running on port 8887
- Check file permissions in data-pipeline directory
- Verify path: `/data-pipeline/admin/index.html`

### API Limitations:
- Static deployment disables API routes
- Python execution only works in development mode
- TODO updates require backend integration for production