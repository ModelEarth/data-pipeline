[Pipeline Admin](../../admin/)


Remove the old zipcode files at:
community-data/us/zipcodes

Important Note: The Census Bureau's ZBP (Zip Code Business Patterns) dataset was discontinued after 2018. This is why only 2018 data is available. For newer data, you would need to use alternative Census datasets like CBP (County Business Patterns) or the Business Dynamics Statistics. 

TO DO: Update the script to also work with CBP (County Business Patterns) or the Business Dynamics Statistics. Include a parameter for setting the source. Move all the parameters into a config file and mention it at the start of the README. 
Inspect data-pipeline/industries for integration.


The Census Bureau ZBP API data is typically 2-3 years behind. You can verify available years at [api.census.gov/data.html](https://api.census.gov/data.html)

# Zipcodes Data Pipeline

  - zipcodes.py: Generates aggregated summary CSV (one row per zipcode with
  totals)
  - zipcodes-naics.py: Generates detailed NAICS-level data (multiple rows
  showing industry breakdown per zipcode) 

  
Initial setup by Benjamin Liu, Summer of 2022.

## Overview

Python scripts for fetching U.S. Census Bureau Zip Code Business Patterns (ZBP) data from the 2018 Census API. Generates CSV files with NAICS industry statistics by zipcode.

## Setup

```bash
# Create and activate virtual environment
python3 -m venv env
source env/bin/activate

# Install dependencies
pip install pandas requests
```

## Python Run Commands

### Generate Aggregated Zipcode Metrics
```bash
# Default: Processes all NAICS levels (2-6) for year 2018
python zipcodes.py

# Specify year, process all levels
python zipcodes.py 2018

# Specify year and single industry level
python zipcodes.py 2018 --naics-level 2

# Process all levels with custom output path
python zipcodes.py 2018 --output-path ../../../community-data/US/zip
```
- Outputs: `zipcodes-naics<level>-<year>.csv` files (5 files when processing all levels)
- Parameters:
  - `year`: Census data year (positional, default: 2018)
  - `--naics-level`: Industry level (2-6, or "all" for levels 2-6, default: all)
  - `--output-path`: Output directory (default: ../../../community-data/US/zip) - created if doesn't exist
- Metrics: Industry count, total establishments, employees, payroll
- When no level is specified, generates 5 files (levels 2-6)
- Results.md is saved only after all levels complete
- Displays output path on run

### Process Zipcodes (Single or Batch)
```bash
# Single zipcode mode
python zipcodes-naics.py --zipcode 98006 --naics-level 2

# Batch mode with custom range
python zipcodes-naics.py --batch-start 3000 --batch-end 3500 --naics-level 2

# Custom year and output path
python zipcodes-naics.py --zipcode 98006 --year 2019 --output-path ../../../community-data/US/zip

# Default batch mode (indices 3000-3500, year 2018, output to ../../../community-data/US/zip)
python zipcodes-naics.py
```
- Outputs: Nested directory structure with detailed NAICS data per zipcode
- Default location: `../../../community-data/US/zip/X/X/X/X/X/zipcode-<XXXXX>-census-naics<level>-<year>.csv`
- Parameters:
  - `--naics-level`: Industry level (2-6, default: 2)
  - `--year`: Census data year (default: 2018)
  - `--output-path`: Output directory (default: ../../../community-data/US/zip) - created if doesn't exist
- Displays output path on run

## Results Files

Both scripts automatically generate result files documenting successful completions:

- **`results.md`**: Generated by `zipcodes.py` with aggregation stats
- **`results-naics.md`**: Generated by `zipcodes-naics.py` with detailed processing stats

These files include:
- Start and end timestamps
- Total run time
- Row counts and processing details
- Total output file size (zipcodes.py excludes naics subfolder)
- Command used to generate the data

## Data Source

Census Bureau ZBP API (2018):
```
https://api.census.gov/data/2018/zbp?get=ZIPCODE,NAICS2017,ESTAB,EMPSZES,PAYANN&for=&INDLEVEL=<level>
```

Industry levels: 2 (broad) to 6 (granular NAICS codes)

Also see [imutation ML](https://model.earth/machine-learning/)